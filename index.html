<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Glitch Store with VOID-11 HARPER</title>
<style>
  body {
    background-color: black;
    color: white;
    font-family: monospace;
    text-align: center;
    overflow-x: hidden;
    padding: 20px;
  }
  .balance {
    font-size: 1.5rem;
    margin-bottom: 20px;
    user-select: none;
  }
  .store, .cart {
    display: inline-block;
    vertical-align: top;
    margin: 0 20px;
  }
  .store {
    max-width: 460px;
  }
  .item {
    display: flex;
    border: 2px solid white;
    margin: 10px 0;
    padding: 10px;
    background: rgba(255,255,255,0.02);
    box-shadow: 0 0 10px red;
    animation: flicker 2s infinite;
    align-items: center;
    justify-content: space-between;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }
  .item img {
    width: 80px;
    filter: url(#glitch);
    transition: filter 0.3s, transform 0.2s;
    margin-right: 15px;
  }
  /* Good next item hover glow */
  .item.good-hover:hover {
    filter: contrast(200%) hue-rotate(90deg) saturate(2);
    transform: scale(1.1) rotate(-2deg);
    border-color: #39ff14;
    box-shadow: 0 0 15px #39ff14;
  }
  /* Wrong next item hover glow */
  .item.wrong-hover:hover {
    border-color: crimson;
    box-shadow:
      0 0 15px crimson,
      0 0 30px crimson inset;
  }
  .item.wrong-hover:hover img {
    filter: contrast(150%) saturate(4) drop-shadow(0 0 5px crimson);
    transform: scale(1.05) rotate(1deg);
  }
  .item-info {
    flex-grow: 1;
    text-align: left;
  }
  button {
    background: transparent;
    color: white;
    border: 1px solid white;
    padding: 5px 10px;
    cursor: pointer;
    transition: background 0.3s, color 0.3s;
    white-space: nowrap;
  }
  button:hover:not(:disabled) {
    background: white;
    color: black;
  }
  button:disabled {
    opacity: 0.3;
    cursor: default;
  }
  h2 {
    margin-top: 0;
  }
  .cart {
    width: 300px;
    border: 2px solid white;
    padding: 10px;
    background: rgba(255,255,255,0.02);
    box-shadow: 0 0 10px red;
    animation: flicker 2s infinite;
  }
  .cart-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
  }
  .total {
    font-weight: bold;
    margin-top: 10px;
    font-size: 1.2rem;
  }
  .checkout-btn {
    margin-top: 15px;
    width: 100%;
    padding: 8px 0;
    font-weight: bold;
  }
  @keyframes flicker {
    0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
      box-shadow: 0 0 10px red;
    }
    20%, 24%, 55% {
      box-shadow: 0 0 2px red;
    }
  }
  #message {
    margin-top: 20px;
    font-weight: bold;
    min-height: 24px;
  }

  /* Chatbot styles */
  #chatbot {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 320px;
    max-height: 400px;
    background: rgba(0,0,0,0.9);
    border: 2px solid #39ff14;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    font-size: 0.9rem;
    z-index: 1000;
    user-select: none;
  }
  #chat-header {
    background: #010;
    padding: 8px 12px;
    color: #39ff14;
    font-weight: bold;
    border-bottom: 1px solid #39ff14;
  }
  #chat-messages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    color: #39ff14;
    text-align: left;
  }
  .chat-message {
    margin-bottom: 10px;
  }
  .chat-message.bot {
    color: #ff0044;
  }
  .chat-message.user {
    color: #39ff14;
    text-align: right;
  }
  #chat-input-area {
    display: flex;
    border-top: 1px solid #39ff14;
  }
  #chat-input {
    flex: 1;
    padding: 8px 10px;
    background: black;
    border: none;
    color: #39ff14;
    font-family: monospace;
  }
  #chat-input:focus {
    outline: none;
  }
  #chat-send-btn {
    background: #39ff14;
    border: none;
    color: black;
    padding: 0 15px;
    cursor: pointer;
    font-weight: bold;
  }
  #chat-send-btn:hover {
    background: #6fff6f;
  }
</style>
</head>
<body>

<h1>Welcome to the Glitch Store</h1>

<div class="balance">Balance: <span id="balance">ðŸ’€ 100</span></div>

<div class="store" id="store"></div>

<div class="cart">
  <h2>Cart</h2>
  <div id="cart-items">No items added.</div>
  <div class="total" id="cart-total">Total: ðŸ’€ 0</div>
  <button class="checkout-btn" id="checkout-btn" disabled>Checkout</button>
  <div id="message"></div>
</div>

<!-- Glitch SVG filter -->
<svg width="0" height="0">
  <filter id="glitch">
    <feTurbulence type="fractalNoise" baseFrequency="0.01" numOctaves="3" result="turb" />
    <feDisplacementMap in="SourceGraphic" in2="turb" scale="10" />
  </filter>
</svg>

<!-- Chatbot UI -->
<div id="chatbot">
  <div id="chat-header">VOID-11 HARPER</div>
  <div id="chat-messages"></div>
  <div id="chat-input-area">
    <input id="chat-input" type="text" placeholder="Ask for a hint or say hello..." />
    <button id="chat-send-btn">Send</button>
  </div>
</div>

<script>
const storeElement = document.getElementById('store');
const balanceElement = document.getElementById('balance');
const cartItemsElement = document.getElementById('cart-items');
const cartTotalElement = document.getElementById('cart-total');
const checkoutBtn = document.getElementById('checkout-btn');
const messageElement = document.getElementById('message');

const skull = 'ðŸ’€';

let balance = 100;

const items = [
  {name: 'Rusty Key', price: 25, img: 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=80&h=80&q=80'},
  {name: 'Foggy Lighthouse', price: 40, img: 'https://images.unsplash.com/photo-1506748686214-e9df14d4d9d0?auto=format&fit=crop&w=80&h=80&q=80'},
  {name: 'Great Lakes Storm', price: 30, img: 'https://images.unsplash.com/photo-1500534623283-312aade485b7?auto=format&fit=crop&w=80&h=80&q=80'},
  {name: 'Misty Forest', price: 20, img: 'https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=80&h=80&q=80'},
  {name: 'Urban Decay', price: 35, img: 'https://images.unsplash.com/photo-1470770903676-69b98201ea1c?auto=format&fit=crop&w=80&h=80&q=80'}
];

let secretSequence = shuffle([...Array(items.length).keys()]);
// console.log("Secret sequence:", secretSequence);

let cart = [];

function shuffle(array) {
  for(let i = array.length -1; i>0; i--){
    const j = Math.floor(Math.random() * (i+1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function renderStore(){
  storeElement.innerHTML = '';
  items.forEach((item, index) => {
    const div = document.createElement('div');
    div.className = 'item';

    const canAfford = (balance >= item.price);
    const nextIndex = secretSequence[cart.length];
    let hoverClass = '';
    if(index === nextIndex){
      hoverClass = 'good-hover';
    } else {
      hoverClass = 'wrong-hover';
    }

    div.innerHTML = `
      <img src="${item.img}" alt="${item.name}">
      <div class="item-info">
        <h3>${item.name}</h3>
        <div>Price: ${skull} ${item.price}</div>
      </div>
      <button ${canAfford ? '' : 'disabled'} onclick="addToCart(${index})">Add to Cart</button>
    `;

    div.classList.add(hoverClass);
    div.querySelector('img').classList.add(hoverClass);

    storeElement.appendChild(div);
  });
  updateBalanceDisplay();
}

function updateBalanceDisplay(){
  balanceElement.textContent = `${skull} ${balance}`;
}

function renderCart(){
  if(cart.length === 0){
    cartItemsElement.textContent = 'No items added.';
    checkoutBtn.disabled = true;
    cartTotalElement.textContent = `Total: ${skull} 0`;
    return;
  }
  cartItemsElement.innerHTML = '';
  let total = 0;
  cart.forEach(i => {
    const item = items[i];
    total += item.price;
    const div = document.createElement('div');
    div.className = 'cart-item';
    div.textContent = `${item.name} - ${skull} ${item.price}`;
    cartItemsElement.appendChild(div);
  });
  cartTotalElement.textContent = `Total: ${skull} ${total}`;
  checkoutBtn.disabled = false;
}

function addToCart(index){
  const item = items[index];
  if(balance < item.price){
    messageElement.textContent = "Not enough skulls to add this item.";
    return;
  }
  cart.push(index);
  balance -= item.price;
  messageElement.textContent = '';
  renderStore();
  renderCart();
}

function resetGame(msg){
  messageElement.textContent = msg || 'Sequence failed. Cart reset.';
  cart.forEach(i => {
    balance += items[i].price;
  });
  cart = [];
  renderStore();
  renderCart();
}

function checkout(){
  if(cart.length !== secretSequence.length){
    resetGame(`You must buy all ${secretSequence.length} items in correct order!`);
    return;
  }
  for(let i=0; i<secretSequence.length; i++){
    if(cart[i] !== secretSequence[i]){
      resetGame('Wrong purchase order! Cart reset.');
      return;
    }
  }
  messageElement.textContent = 'You unlocked the backroom...';
  localStorage.setItem('backroomUnlocked', 'true');
  showBackroomLink();
  checkoutBtn.disabled = true;
}

function showBackroomLink() {
  let link = document.getElementById('backroomLink');
  if (!link) {
    link = document.createElement('a');
    link.id = 'backroomLink';
    link.href = 'backroom.html';
    link.textContent = 'Enter the Backroom';
    link.style.display = 'block';
    link.style.marginTop = '20px';
    link.style.color = '#39ff14';
    link.style.fontWeight = 'bold';
    document.body.appendChild(link);
  }
  link.style.display = 'block';
}

if(localStorage.getItem('backroomUnlocked') === 'true'){
  showBackroomLink();
}

checkoutBtn.onclick = checkout;

renderStore();
renderCart();

/* ----------------- VOID-11 HARPER Chatbot logic ----------------- */
const chatMessages = document.getElementById('chat-messages');
const chatInput = document.getElementById('chat-input');
const chatSendBtn = document.getElementById('chat-send-btn');

function appendMessage(text, sender='bot'){
  const div = document.createElement('div');
  div.className = 'chat-message ' + sender;
  div.textContent = text;
  chatMessages.appendChild(div);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Cryptic, mysterious chatbot replies
function getBotReply(input){
  input = input.toLowerCase().trim();

  if(input.includes('hello') || input.includes('hi') || input.includes('hey')){
    return "â€¦You have wandered far. But the sequence bends like shadows in the void.";
  }
  if(input.includes('hint')){
    return "The path is not linear, yet each step is destined. Listen closely to silence between purchases.";
  }
  if(input.includes('key')){
    return "A key rusted with time. It whispers of locked doors that should not open yet.";
  }
  if(input.includes('lighthouse')){
    return "A beacon obscured by fog. It flickers only for those who watch patiently.";
  }
  if(input.includes('storm')){
    return "Raging waters churn secrets beneath calm surfaces.";
  }
  if(input.includes('forest')){
    return "Among the misted trees, footprints vanish and return elsewhere.";
  }
  if(input.includes('decay')){
    return "Decay conceals, but also reveals â€” tread with measured steps.";
  }
  if(input.includes('order')){
    return "Order is a fragile illusion. Break it and all resets.";
  }
  if(input.includes('money') || input.includes('skull')){
    return "Skulls are finite. Spend them, but do not squander your essence.";
  }
  if(input.includes('cart')){
    return "Your cart cradles fate â€” choose what lingers and what fades.";
  }

  const responses = [
    "â€¦Listen. The void murmurs your missteps.",
    "The wrong choice casts a long shadow.",
    "Trust in the unseen pattern, for sight betrays.",
    "A single misstep fractures the sequence.",
    "Not all items are meant to be bought first."
  ];
  return responses[Math.floor(Math.random() * responses.length)];
}

function userSendMessage(){
  const text = chatInput.value.trim();
  if(!text) return;
  appendMessage(text, 'user');
  chatInput.value = '';

  setTimeout(() => {
    const reply = getBotReply(text);
    appendMessage(reply, 'bot');
  }, 800);
}

chatSendBtn.addEventListener('click', userSendMessage);
chatInput.addEventListener('keydown', (e) => {
  if(e.key === 'Enter') {
    userSendMessage();
  }
});

// Greet on load
appendMessage("VOID-11 HARPER online. Need a hint? Speak softly...", 'bot');
</script>

</body>
</html>
